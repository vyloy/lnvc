<?xml version="1.0" encoding="UTF-8"?>
<project name="lvmc" basedir="." default="makePackage">
	<property environment="env"/>
	<property name="installshield.cmd.dir" location="${env.InstallShield_HOME}\2009\System" />
	<property name="lvnc.dir" location="../.." />
	<property name="clientcommon.dir" location="${lvnc.dir}/common/clientcommon" />
	<property name="pack.dir" location="${lvnc.dir}/../lnvc2_pack" />
	<property name="lvmc.pack.dir" location="${pack.dir}/tools/install_tool/lvmc_project/lvmc" />
	<property name="launch4j.dir" location="${pack.dir}/tools/Launch4j" />
	<property name="dest.dir" location="${lvnc.dir}/../output" />

	<patternset id="copy.files">
		<include name="vnc/**" />
		<include name="lvmc.exe" />
	</patternset>
	<target name="clean">
		<delete dir="${lvmc.pack.dir}/jre/launch4j-tmp" />
		<delete dir="${pack.dir}/tools/install_tool/lvmc_project/PROJECT_ASSISTANT/SINGLE_EXE_IMAGE" />
		<delete includeemptydirs="true">
			<fileset dir="${lvmc.pack.dir}">
				<patternset refid="copy.files" />
				<include name="lvmc_lib/**" />
				<include name="lvmc.jar" />
				<include name="lvmc-lvmc.jar" />
			</fileset>
		</delete>

	</target>
	<target name="makePackage" depends="clean">
		<mkdir dir="${lvmc.pack.dir}/jre/launch4j-tmp" />
		<copy todir="${lvmc.pack.dir}/jre/launch4j-tmp">
			<fileset dir="${clientcommon.dir}/dll">
				<include name="**" />
			</fileset>
		</copy>
		<copy todir="${lvmc.pack.dir}" >
			<fileset dir="${basedir}">
				<patternset refid="copy.files" />
			</fileset>
			<fileset dir="${basedir}/bin">
				<include name="lvmc_lib/**" />
				<include name="lvmc-lvmc.jar" />
			</fileset>
		</copy>
		<move file="${lvmc.pack.dir}/lvmc-lvmc.jar" tofile="${lvmc.pack.dir}/lvmc.jar"></move>
		<antcall target="buildexe">
		</antcall>
		<delete file="${lvmc.pack.dir}/lvmc.jar"/>  
		<mkdir dir="${dest.dir}" />
		<antcall target="buildInstallPackage">
		</antcall>
	</target>
	<target name="buildexe">
	
		<taskdef name="launch4j" classname="net.sf.launch4j.ant.Launch4jTask" classpath="${launch4j.dir}/launch4j.jar:${launch4j.dir}/lib/xstream.jar" />
		<launch4j configFile="${lvmc.pack.dir}/lvmc.xml" />
	
	</target>
	<target name="buildInstallPackage">
		<exec executable="${installshield.cmd.dir}\iscmdbld.exe">
			<arg value="-p" />
			<arg value="${pack.dir}/tools/install_tool/lvmc_project.ism" />
		</exec>
	</target>
</project>